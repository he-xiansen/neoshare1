{% extends 'base.html' %}

{% block content %}
    <!-- æœç´¢æ¡† -->
    <div class="search-container">
        <form method="GET" action="{{ url_for('search') }}" style="width: 100%; display: flex; gap: 1rem;">
            <input type="text" name="q" placeholder="æœç´¢æ–‡ä»¶..." class="search-input" value="{{ request.args.get('q', '') }}">
            <button type="submit" class="btn btn-primary">æœç´¢</button>
        </form>
    </div>

    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <div class="card">
        <h3>ä¸Šä¼ æ–‡ä»¶</h3>
        <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" class="upload-form">
            <label for="file-upload" class="upload-label">
                ğŸ“ é€‰æ‹©æ–‡ä»¶
            </label>
            <input type="file" id="file-upload" name="file" required>
            <br>
            <div class="checkbox-container">
                <input type="checkbox" id="is-public" name="is_public">
                <label for="is-public">è®¾ä¸ºå…¬å…±æ–‡ä»¶</label>
            </div>
            <br>
            <button type="submit" class="btn btn-primary">ä¸Šä¼ æ–‡ä»¶</button>
        </form>
    </div>

    <!-- ä¸ªäººæ–‡ä»¶åˆ—è¡¨ -->
    <div class="card">
        <h3>æˆ‘çš„æ–‡ä»¶</h3>
        <div class="file-list">
            {% if user_files %}
                {% for file in user_files %}
                    <div class="file-item">
                        <div class="file-icon">ğŸ“„</div>
                        <div class="file-name">{{ file.filename }}</div>
                        <div class="file-meta">
                            <p>å¤§å°: {{ (file.file_size / 1024)|round(2) }} KB</p>
                            <p>ä¸Šä¼ æ—¶é—´: {{ file.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            <p>çŠ¶æ€: {{ 'å…¬å…±' if file.is_public else 'ç§æœ‰' }}</p>
                        </div>
                        <div class="file-actions">
                            <a href="{{ url_for('preview_file', file_id=file.id) }}" class="btn btn-secondary">é¢„è§ˆ</a>
                            <a href="{{ url_for('edit_file', file_id=file.id) }}" class="btn btn-primary">ç¼–è¾‘</a>
                            <a href="{{ url_for('download_file', filename=file.filepath.replace('uploads/', '')) }}" class="btn btn-success">ä¸‹è½½</a>
                            <a href="{{ url_for('delete_file', file_id=file.id) }}" class="btn btn-danger" onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')">åˆ é™¤</a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">æš‚æ— ä¸ªäººæ–‡ä»¶</p>
            {% endif %}
        </div>
    </div>

    <!-- å…¬å…±æ–‡ä»¶åˆ—è¡¨ -->
    <div class="card">
        <h3>å…¬å…±æ–‡ä»¶</h3>
        <div class="file-list">
            {% if public_files %}
                {% for file in public_files %}
                    <div class="file-item">
                        <div class="file-icon">ğŸ“„</div>
                        <div class="file-name">{{ file.filename }}</div>
                        <div class="file-meta">
                            <p>å¤§å°: {{ (file.file_size / 1024)|round(2) }} KB</p>
                            <p>ä¸Šä¼ æ—¶é—´: {{ file.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                        <div class="file-actions">
                            <a href="{{ url_for('preview_file', file_id=file.id) }}" class="btn btn-secondary">é¢„è§ˆ</a>
                            <a href="{{ url_for('download_file', filename=file.filepath.replace('uploads/', '')) }}" class="btn btn-primary">ä¸‹è½½</a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">æš‚æ— å…¬å…±æ–‡ä»¶</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
