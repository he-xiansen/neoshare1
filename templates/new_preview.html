{% extends 'new_base.html' %}

{% block content %}
    <div class="preview-container">
        <div class="preview-header">
            <h2 class="preview-title">{{ file.filename }}</h2>
            <div style="display: flex; gap: 1rem;">
                {% set ext = file.filename.rsplit('.', 1)[1].lower() if '.' in file.filename else '' %}
                {% if ext in ['txt', 'md', 'markdown', 'py', 'js', 'html', 'css', 'json', 'xml', 'yaml', 'yml', 'sh', 'bat', 'cmd'] %}
                    <a href="{{ url_for('edit_file', file_id=file.id) }}" class="btn btn-primary">编辑</a>
                {% endif %}
                <a href="{{ url_for('download_file', filename=file.filepath.replace('uploads_new/', '')) }}" class="btn btn-success">下载</a>
                {% if current_user.is_authenticated and (file.owner_id == current_user.id or current_user.is_admin) %}
                    <a href="{{ url_for('delete_file', file_id=file.id) }}" class="btn btn-danger" onclick="return confirm('确定要删除这个文件吗？')">删除</a>
                {% endif %}
            </div>
        </div>

        <div class="preview-content">
            {% set ext = file.filename.rsplit('.', 1)[1].lower() if '.' in file.filename else '' %}
            
            {% if ext in ['txt', 'md', 'markdown', 'py', 'js', 'html', 'css', 'json', 'xml', 'yaml', 'yml', 'sh', 'bat', 'cmd'] %}
                <!-- 文本文件预览 -->
                <pre style="white-space: pre-wrap; word-wrap: break-word; color: #ffffff; font-family: 'Courier New', Courier, monospace;">
                    {{ content if content else '文件内容为空' }}
                </pre>
            {% elif ext in ['pdf'] %}
                <!-- PDF 文件预览 -->
                <div style="background: #ffffff; padding: 1rem; border-radius: 8px;">
                    <embed src="{{ url_for('preview_file_route', filename=relative_filepath) }}" type="application/pdf" width="100%" height="600px">
                </div>
            {% else %}
                <!-- 其他文件类型 -->
                <p style="text-align: center; font-size: 1.2rem; color: var(--text-secondary);">
                    不支持预览此文件类型 ({{ ext }}), 请下载查看。
                </p>
            {% endif %}
        </div>
    </div>
{% endblock %}
